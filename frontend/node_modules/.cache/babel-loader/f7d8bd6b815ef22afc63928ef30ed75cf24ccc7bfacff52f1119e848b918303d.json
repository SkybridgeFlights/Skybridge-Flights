{"ast":null,"code":"// frontend/src/pages/PaymentPage.js\nimport React,{useEffect,useState}from'react';import{useParams,useNavigate}from'react-router-dom';import axios from'axios';import{API_BASE_URL}from'../apiConfig';import'./PaymentPage.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const PaymentPage=()=>{var _booking$passengers,_booking$passengers$;const{bookingId}=useParams();const navigate=useNavigate();const[booking,setBooking]=useState(null);const[isProcessing,setIsProcessing]=useState(false);useEffect(()=>{const token=localStorage.getItem('token');if(!token){alert('You must be logged in to continue.');navigate('/login');return;}const fetchBookingData=async()=>{try{const bookingRes=await axios.get(`${API_BASE_URL}/api/bookings/${bookingId}`,{headers:{Authorization:`Bearer ${token}`}});setBooking(bookingRes.data);}catch(err){var _err$response;console.error('Failed to load booking:',(err===null||err===void 0?void 0:(_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.data)||err.message);alert('Failed to load booking.');}};fetchBookingData();},[bookingId,navigate]);const handlePayment=async()=>{const token=localStorage.getItem('token');if(!token){alert('You must be logged in to continue.');navigate('/login');return;}try{setIsProcessing(true);// (هنا تضع أي عملية دفع حقيقية أو وهمية)\n// سنستخدم setTimeout لمحاكاة بوابة الدفع\nawait new Promise(resolve=>setTimeout(resolve,1500));// تأكيد الحجز بعد \"الدفع\"\nawait axios.patch(`${API_BASE_URL}/api/bookings/${bookingId}/confirm`,{},{headers:{Authorization:`Bearer ${token}`}});navigate(`/ticket/${bookingId}`);}catch(err){var _err$response2;console.error('Payment/confirm error:',(err===null||err===void 0?void 0:(_err$response2=err.response)===null||_err$response2===void 0?void 0:_err$response2.data)||err.message);alert('Payment failed or confirm failed. Please try again.');setIsProcessing(false);}};if(!booking){return/*#__PURE__*/_jsxs(\"div\",{className:\"payment-container\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Processing Payment...\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Please wait while we confirm your booking and generate your ticket.\"})]});}const outbound=booking.flight;// populated\nconst inbound=booking.returnFlight;// populated or null\nconst baseOutbound=booking.totalPrice||0;const baseInbound=booking.totalPriceReturn||0;const total=baseOutbound+baseInbound;return/*#__PURE__*/_jsx(\"div\",{className:\"payment-container\",children:!isProcessing?/*#__PURE__*/_jsxs(\"div\",{className:\"payment-box\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83D\\uDCB3 Complete Payment\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Passenger:\"}),\" \",((_booking$passengers=booking.passengers)===null||_booking$passengers===void 0?void 0:(_booking$passengers$=_booking$passengers[0])===null||_booking$passengers$===void 0?void 0:_booking$passengers$.name)||'N/A']}),/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDEEB Outbound Flight\"}),outbound?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"From:\"}),\" \",outbound.from,\" \\u2794 \",outbound.to]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Airline:\"}),\" \",outbound.airline||'N/A']}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Seat:\"}),\" \",booking.seatNumber||'Not selected']}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Subtotal:\"}),\" \\u20AC\",baseOutbound]})]}):/*#__PURE__*/_jsx(\"p\",{children:\"Outbound flight not found.\"}),inbound&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDD01 Return Flight\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"From:\"}),\" \",inbound.from,\" \\u2794 \",inbound.to]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Airline:\"}),\" \",inbound.airline||'N/A']}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Seat:\"}),\" \",booking.seatNumberReturn||'Not selected']}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Subtotal:\"}),\" \\u20AC\",baseInbound]})]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Total Price:\"}),\" \\u20AC\",total]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Payment Method:\"}),\" \",booking.paymentMethod]}),/*#__PURE__*/_jsx(\"button\",{className:\"pay-btn\",onClick:handlePayment,children:\"Pay Now\"})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"payment-box processing\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83D\\uDD04 Processing Payment...\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Please wait while we confirm your booking and generate your ticket.\"})]})});};export default PaymentPage;","map":{"version":3,"names":["React","useEffect","useState","useParams","useNavigate","axios","API_BASE_URL","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","PaymentPage","_booking$passengers","_booking$passengers$","bookingId","navigate","booking","setBooking","isProcessing","setIsProcessing","token","localStorage","getItem","alert","fetchBookingData","bookingRes","get","headers","Authorization","data","err","_err$response","console","error","response","message","handlePayment","Promise","resolve","setTimeout","patch","_err$response2","className","children","outbound","flight","inbound","returnFlight","baseOutbound","totalPrice","baseInbound","totalPriceReturn","total","passengers","name","from","to","airline","seatNumber","seatNumberReturn","paymentMethod","onClick"],"sources":["C:/Users/Wajd Shaaban/OneDrive/Desktop/SkybridgeFlights/frontend/src/pages/PaymentPage.js"],"sourcesContent":["// frontend/src/pages/PaymentPage.js\r\nimport React, { useEffect, useState } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport { API_BASE_URL } from '../apiConfig';\r\nimport './PaymentPage.css';\r\n\r\nconst PaymentPage = () => {\r\n  const { bookingId } = useParams();\r\n  const navigate = useNavigate();\r\n\r\n  const [booking, setBooking] = useState(null);\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n\r\n  useEffect(() => {\r\n    const token = localStorage.getItem('token');\r\n    if (!token) {\r\n      alert('You must be logged in to continue.');\r\n      navigate('/login');\r\n      return;\r\n    }\r\n\r\n    const fetchBookingData = async () => {\r\n      try {\r\n        const bookingRes = await axios.get(\r\n          `${API_BASE_URL}/api/bookings/${bookingId}`,\r\n          { headers: { Authorization: `Bearer ${token}` } }\r\n        );\r\n        setBooking(bookingRes.data);\r\n      } catch (err) {\r\n        console.error('Failed to load booking:', err?.response?.data || err.message);\r\n        alert('Failed to load booking.');\r\n      }\r\n    };\r\n\r\n    fetchBookingData();\r\n  }, [bookingId, navigate]);\r\n\r\n  const handlePayment = async () => {\r\n    const token = localStorage.getItem('token');\r\n    if (!token) {\r\n      alert('You must be logged in to continue.');\r\n      navigate('/login');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      setIsProcessing(true);\r\n\r\n      // (هنا تضع أي عملية دفع حقيقية أو وهمية)\r\n      // سنستخدم setTimeout لمحاكاة بوابة الدفع\r\n      await new Promise((resolve) => setTimeout(resolve, 1500));\r\n\r\n      // تأكيد الحجز بعد \"الدفع\"\r\n      await axios.patch(\r\n        `${API_BASE_URL}/api/bookings/${bookingId}/confirm`,\r\n        {},\r\n        { headers: { Authorization: `Bearer ${token}` } }\r\n      );\r\n\r\n      navigate(`/ticket/${bookingId}`);\r\n    } catch (err) {\r\n      console.error('Payment/confirm error:', err?.response?.data || err.message);\r\n      alert('Payment failed or confirm failed. Please try again.');\r\n      setIsProcessing(false);\r\n    }\r\n  };\r\n\r\n  if (!booking) {\r\n    return (\r\n      <div className=\"payment-container\">\r\n        <h2>Processing Payment...</h2>\r\n        <p>Please wait while we confirm your booking and generate your ticket.</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const outbound = booking.flight;        // populated\r\n  const inbound  = booking.returnFlight;  // populated or null\r\n\r\n  const baseOutbound = booking.totalPrice || 0;\r\n  const baseInbound  = booking.totalPriceReturn || 0;\r\n\r\n  const total = baseOutbound + baseInbound;\r\n\r\n  return (\r\n    <div className=\"payment-container\">\r\n      {!isProcessing ? (\r\n        <div className=\"payment-box\">\r\n          <h2>💳 Complete Payment</h2>\r\n          <p><strong>Passenger:</strong> {booking.passengers?.[0]?.name || 'N/A'}</p>\r\n\r\n          <h3>🛫 Outbound Flight</h3>\r\n          {outbound ? (\r\n            <>\r\n              <p><strong>From:</strong> {outbound.from} ➔ {outbound.to}</p>\r\n              <p><strong>Airline:</strong> {outbound.airline || 'N/A'}</p>\r\n              <p><strong>Seat:</strong> {booking.seatNumber || 'Not selected'}</p>\r\n              <p><strong>Subtotal:</strong> €{baseOutbound}</p>\r\n            </>\r\n          ) : <p>Outbound flight not found.</p>}\r\n\r\n          {inbound && (\r\n            <>\r\n              <hr />\r\n              <h3>🔁 Return Flight</h3>\r\n              <p><strong>From:</strong> {inbound.from} ➔ {inbound.to}</p>\r\n              <p><strong>Airline:</strong> {inbound.airline || 'N/A'}</p>\r\n              <p><strong>Seat:</strong> {booking.seatNumberReturn || 'Not selected'}</p>\r\n              <p><strong>Subtotal:</strong> €{baseInbound}</p>\r\n            </>\r\n          )}\r\n\r\n          <hr />\r\n          <p><strong>Total Price:</strong> €{total}</p>\r\n          <p><strong>Payment Method:</strong> {booking.paymentMethod}</p>\r\n\r\n          <button className=\"pay-btn\" onClick={handlePayment}>Pay Now</button>\r\n        </div>\r\n      ) : (\r\n        <div className=\"payment-box processing\">\r\n          <h2>🔄 Processing Payment...</h2>\r\n          <p>Please wait while we confirm your booking and generate your ticket.</p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PaymentPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}