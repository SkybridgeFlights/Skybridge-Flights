{"ast":null,"code":"// frontend/src/pages/RefundPage.js\nimport React,{useEffect,useState}from'react';import{useParams,useNavigate,useLocation}from'react-router-dom';import axios from'axios';import{API_BASE_URL}from'../apiConfig';import'./RefundPage.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const RefundPage=()=>{var _location$state,_booking$passengers,_booking$passengers$,_booking$flight,_booking$flight2;const{bookingId}=useParams();const location=useLocation();// Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ù‚Ø§Ø¯Ù… Ù…Ù† Ø§Ù„Ù…ÙˆØ¯Ø§Ù„\nconst[booking,setBooking]=useState(null);const[reason,setReason]=useState(((_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.reason)||'Change of plans');const[customReason,setCustomReason]=useState('');const[submitting,setSubmitting]=useState(false);const[refundStatus,setRefundStatus]=useState(null);const navigate=useNavigate();useEffect(()=>{const fetchBooking=async()=>{try{const token=localStorage.getItem('token');if(!token){alert('Please log in to access this page.');navigate('/login');return;}const res=await axios.get(`${API_BASE_URL}/api/bookings/${bookingId}`,{headers:{Authorization:`Bearer ${token}`}});setBooking(res.data);}catch(error){console.error('Failed to fetch booking:',error);alert('Failed to load booking details.');navigate('/bookings');}};fetchBooking();},[bookingId,navigate]);const handleRefund=async()=>{const finalReason=reason==='Other'&&customReason.trim()?customReason.trim():reason;if(!finalReason){alert('Please select or provide a reason for the refund.');return;}if(!window.confirm('Are you sure you want to request a refund for this booking?'))return;try{setSubmitting(true);const token=localStorage.getItem('token');const res=await axios.post(`${API_BASE_URL}/api/refunds`,{bookingId,reason:finalReason},{headers:{Authorization:`Bearer ${token}`}});setRefundStatus(res.data.refundRequest.status);alert(`Refund request submitted. Amount: â‚¬${res.data.refundRequest.amount}`);navigate('/bookings');}catch(error){console.error('Refund request failed:',error);alert('Failed to create refund request.');}finally{setSubmitting(false);}};if(!booking){return/*#__PURE__*/_jsx(\"div\",{className:\"refund-container\",children:/*#__PURE__*/_jsx(\"p\",{children:\"Loading booking details...\"})});}const totalPaid=(booking.totalPrice||0)+(booking.totalPriceReturn||0);return/*#__PURE__*/_jsxs(\"div\",{className:\"refund-container\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83D\\uDCB3 Request Refund\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"refund-card\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Passenger:\"}),\" \",((_booking$passengers=booking.passengers)===null||_booking$passengers===void 0?void 0:(_booking$passengers$=_booking$passengers[0])===null||_booking$passengers$===void 0?void 0:_booking$passengers$.name)||'N/A']}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Flight:\"}),\" \",(_booking$flight=booking.flight)===null||_booking$flight===void 0?void 0:_booking$flight.from,\" \\u2192 \",(_booking$flight2=booking.flight)===null||_booking$flight2===void 0?void 0:_booking$flight2.to]}),booking.returnFlight&&/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Return Flight:\"}),\" \",booking.returnFlight.from,\" \\u2192 \",booking.returnFlight.to]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Total Paid:\"}),\" \\u20AC\",totalPaid]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Status:\"}),\" \",booking.status]}),/*#__PURE__*/_jsxs(\"div\",{className:\"reason-section\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Reason for Refund\"}),/*#__PURE__*/_jsxs(\"select\",{value:reason,onChange:e=>setReason(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"Change of plans\",children:\"Change of plans\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Medical reasons\",children:\"Medical reasons\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Flight cancellation by airline\",children:\"Flight cancellation by airline\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Other\",children:\"Other\"})]}),reason==='Other'&&/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"Please specify the reason...\",value:customReason,onChange:e=>setCustomReason(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"refund-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn-back\",onClick:()=>navigate('/bookings'),children:\"Back\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-refund\",onClick:handleRefund,disabled:submitting,children:submitting?'Submitting...':'Confirm Refund'})]})]})]});};export default RefundPage;","map":{"version":3,"names":["React","useEffect","useState","useParams","useNavigate","useLocation","axios","API_BASE_URL","jsx","_jsx","jsxs","_jsxs","RefundPage","_location$state","_booking$passengers","_booking$passengers$","_booking$flight","_booking$flight2","bookingId","location","booking","setBooking","reason","setReason","state","customReason","setCustomReason","submitting","setSubmitting","refundStatus","setRefundStatus","navigate","fetchBooking","token","localStorage","getItem","alert","res","get","headers","Authorization","data","error","console","handleRefund","finalReason","trim","window","confirm","post","refundRequest","status","amount","className","children","totalPaid","totalPrice","totalPriceReturn","passengers","name","flight","from","to","returnFlight","value","onChange","e","target","placeholder","onClick","disabled"],"sources":["C:/Users/Wajd Shaaban/OneDrive/Desktop/SkybridgeFlights/frontend/src/pages/RefundPage.js"],"sourcesContent":["// frontend/src/pages/RefundPage.js\r\nimport React, { useEffect, useState } from 'react';\r\nimport { useParams, useNavigate, useLocation } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport { API_BASE_URL } from '../apiConfig';\r\nimport './RefundPage.css';\r\n\r\nconst RefundPage = () => {\r\n  const { bookingId } = useParams();\r\n  const location = useLocation(); // Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ù‚Ø§Ø¯Ù… Ù…Ù† Ø§Ù„Ù…ÙˆØ¯Ø§Ù„\r\n  const [booking, setBooking] = useState(null);\r\n  const [reason, setReason] = useState(location.state?.reason || 'Change of plans');\r\n  const [customReason, setCustomReason] = useState('');\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [refundStatus, setRefundStatus] = useState(null);\r\n  const navigate = useNavigate();\r\n\r\n  useEffect(() => {\r\n    const fetchBooking = async () => {\r\n      try {\r\n        const token = localStorage.getItem('token');\r\n        if (!token) {\r\n          alert('Please log in to access this page.');\r\n          navigate('/login');\r\n          return;\r\n        }\r\n\r\n        const res = await axios.get(`${API_BASE_URL}/api/bookings/${bookingId}`, {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n        setBooking(res.data);\r\n      } catch (error) {\r\n        console.error('Failed to fetch booking:', error);\r\n        alert('Failed to load booking details.');\r\n        navigate('/bookings');\r\n      }\r\n    };\r\n\r\n    fetchBooking();\r\n  }, [bookingId, navigate]);\r\n\r\n  const handleRefund = async () => {\r\n    const finalReason = reason === 'Other' && customReason.trim() ? customReason.trim() : reason;\r\n\r\n    if (!finalReason) {\r\n      alert('Please select or provide a reason for the refund.');\r\n      return;\r\n    }\r\n\r\n    if (!window.confirm('Are you sure you want to request a refund for this booking?')) return;\r\n\r\n    try {\r\n      setSubmitting(true);\r\n      const token = localStorage.getItem('token');\r\n      const res = await axios.post(\r\n        `${API_BASE_URL}/api/refunds`,\r\n        { bookingId, reason: finalReason },\r\n        { headers: { Authorization: `Bearer ${token}` } }\r\n      );\r\n\r\n      setRefundStatus(res.data.refundRequest.status);\r\n      alert(`Refund request submitted. Amount: â‚¬${res.data.refundRequest.amount}`);\r\n      navigate('/bookings');\r\n    } catch (error) {\r\n      console.error('Refund request failed:', error);\r\n      alert('Failed to create refund request.');\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  if (!booking) {\r\n    return (\r\n      <div className=\"refund-container\">\r\n        <p>Loading booking details...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const totalPaid = (booking.totalPrice || 0) + (booking.totalPriceReturn || 0);\r\n\r\n  return (\r\n    <div className=\"refund-container\">\r\n      <h2>ðŸ’³ Request Refund</h2>\r\n      <div className=\"refund-card\">\r\n        <p><strong>Passenger:</strong> {booking.passengers?.[0]?.name || 'N/A'}</p>\r\n        <p>\r\n          <strong>Flight:</strong> {booking.flight?.from} â†’ {booking.flight?.to}\r\n        </p>\r\n        {booking.returnFlight && (\r\n          <p>\r\n            <strong>Return Flight:</strong> {booking.returnFlight.from} â†’ {booking.returnFlight.to}\r\n          </p>\r\n        )}\r\n        <p><strong>Total Paid:</strong> â‚¬{totalPaid}</p>\r\n        <p><strong>Status:</strong> {booking.status}</p>\r\n\r\n        <div className=\"reason-section\">\r\n          <label>Reason for Refund</label>\r\n          <select value={reason} onChange={(e) => setReason(e.target.value)}>\r\n            <option value=\"Change of plans\">Change of plans</option>\r\n            <option value=\"Medical reasons\">Medical reasons</option>\r\n            <option value=\"Flight cancellation by airline\">Flight cancellation by airline</option>\r\n            <option value=\"Other\">Other</option>\r\n          </select>\r\n          {reason === 'Other' && (\r\n            <textarea\r\n              placeholder=\"Please specify the reason...\"\r\n              value={customReason}\r\n              onChange={(e) => setCustomReason(e.target.value)}\r\n            ></textarea>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"refund-actions\">\r\n          <button className=\"btn-back\" onClick={() => navigate('/bookings')}>\r\n            Back\r\n          </button>\r\n          <button className=\"btn-refund\" onClick={handleRefund} disabled={submitting}>\r\n            {submitting ? 'Submitting...' : 'Confirm Refund'}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RefundPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}